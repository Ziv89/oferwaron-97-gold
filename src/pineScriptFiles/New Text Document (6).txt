strategy("XAUUSD Simple", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)
rsi = ta.rsi(close, 14)
atr = ta.atr(14)
vwap = ta.vwap

longCond = ta.crossover(macdLine, signalLine) and rsi > 50 and close > vwap
shortCond = ta.crossunder(macdLine, signalLine) and rsi < 50 and close < vwap

longTP = close + atr * 2
longSL = close - atr * 1.5
shortTP = close - atr * 2
shortSL = close + atr * 1.5

inTrade = nz(inTrade[1], false)
isLong = nz(isLong[1], false)
entryPrice = nz(entryPrice[1])
tradeLabel = na(tradeLabel[1]) ? na : tradeLabel[1]

if not inTrade and longCond
    strategy.entry("Long", strategy.long)
    inTrade := true
    isLong := true
    entryPrice := close

if not inTrade and shortCond
    strategy.entry("Short", strategy.short)
    inTrade := true
    isLong := false
    entryPrice := close

tp = isLong ? longTP : shortTP
sl = isLong ? longSL : shortSL
tpHit = isLong ? high >= tp : low <= tp
slHit = isLong ? low <= sl : high >= sl

if inTrade and (tpHit or slHit)
    strategy.exit("Exit", from_entry = isLong ? "Long" : "Short", limit = tp, stop = sl)
    label.delete(tradeLabel)
    tradeLabel := label.new(bar_index, high, "Success: " + str.tostring(tpHit ? 100 : 0) + "%",
        style=label.style_label_down, color=tpHit ? color.green : color.red, textcolor=color.white)
    inTrade := false