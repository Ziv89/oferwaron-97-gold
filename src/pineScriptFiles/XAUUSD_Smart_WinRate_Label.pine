//@version=5
strategy("XAUUSD Strategy - Smart Win Rate Label", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// === פונקציה לצבע לפי אחוז הצלחה ===
getColor(rate) =>
    rate >= 95 ? color.aqua :
    rate >= 85 ? color.yellow :
    rate >= 70 ? color.orange :
    color.red

// === חישוב אחוז הצלחה רטרואקטיבי אמיתי ===
displayWinRate = strategy.closedtrades > 0 ? (strategy.wintrades * 100) / strategy.closedtrades : na

// === הצגת תווית רק אם יש הצלחה תקפה ===
if not na(displayWinRate) and displayWinRate >= 70
    winRateText = "Win Rate: " + str.tostring(displayWinRate, "#.0") + "%"
    label.new(
        x=bar_index,
        y=high,
        text=winRateText,
        style=label.style_label_down,
        textcolor=color.black,
        size=size.normal,
        color=getColor(displayWinRate)
    )

// === דוגמה לתנאים פשוטים לעסקאות (לא חובה, אפשר להוסיף אסטרטגיה כאן) ===
[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)
rsi = ta.rsi(close, 14)
longCond = ta.crossover(macdLine, signalLine) and rsi > 50
shortCond = ta.crossunder(macdLine, signalLine) and rsi < 50

if longCond
    strategy.entry("Long", strategy.long)
if shortCond
    strategy.entry("Short", strategy.short)